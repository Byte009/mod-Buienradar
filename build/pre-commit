#! /usr/bin/env bash

echo "Executing pre-commit hook at $(pwd)"

controls_file="controls_Irigation.txt"
changed_file="CHANGED"


function createControlsFile {
    find . -type f -iname '.DS_Store' -delete

    test -e "${controls_file}" && rm "${controls_file}"
    find -type f \( -path "./FHEM/*" -o -path './www/*' \) -print0 | while IFS= read -r -d '' f;
    do
        echo "DEL ${f}" >> ${controls_file}
        out="UPD "$(stat -c %y  $f | cut -d. -f1 | awk '{printf "%s_%s",$1,$2}')" "$(stat -c %s $f)" ${f}"
        echo ${out//.\//} >> ${controls_file}
    done

    git add $controls_file
    git add $changed_file
}

createControlsFile
